<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.web.mapper.FoodMapper">
  <resultMap type="com.sist.web.vo.FoodVO" id="foodMap">
    <result property="fno" column="fno"/>
    <result property="poster" column="poster"/>
    <result property="name" column="name"/>
  </resultMap>
  <!-- 
      private int fno,hit,jjimcount,likecount,replycount;
	  private String name,type,phone,address,theme,price,time,
	          parking,poster,images,content;
	  private double score;
   -->
   <resultMap type="com.sist.web.vo.FoodVO" id="detailMap">
     <result property="fno" column="fno"/>
     <result property="poster" column="poster"/>
     <result property="name" column="name"/>
     <result property="hit" column="hit"/>
     <result property="jjimcount" column="jjimcount"/>
     <result property="type" column="type"/>
     <result property="phone" column="phone"/>
     <result property="address" column="address"/>
     <result property="theme" column="theme"/>
     <result property="price" column="price"/>
     <result property="time" column="time"/>
     <result property="parking" column="parking"/>
     <result property="images" column="images"/>
     <result property="content" column="content"/>
     <result property="score" column="score"/>
   </resultMap>
   <!--  검색  
      prefixOverrides 제거 
      prefix  추가
      
      WHERE OR name LIKE '%%' 
            OR type LIKE '%%'
            OR address LIKE '%%'
            
            fsArr=[N,T,A]
            
      1. foreach => 배열 / IN
      2. trim : 제거 / 추가 
      3. if : 단일 조건문 
      4. choose 
   -->
   <select id="foodFindData" resultType="com.sist.web.vo.FoodVO"
    parameterType="hashmap"
   >
     SELECT fno,poster,name
     FROM menupan_food
     <where> 
       <if test="fsArr!=null">
	     <trim prefixOverrides="OR">
	      <foreach collection="fsArr" item="fd">
	       <trim prefix="OR">
	         <choose>
	           <when test="fd=='N'.toString()">
	             name LIKE '%'||#{ss}||'%'
	           </when>
	           <when test="fd=='T'.toString()">
	             type LIKE '%'||#{ss}||'%'
	           </when>
	           <when test="fd=='A'.toString()">
	             address LIKE '%'||#{ss}||'%'
	           </when>
	         </choose>
	       </trim>
	      </foreach>
	     </trim>
	    </if>
     </where>
     OFFSET #{start} ROWS FETCH NEXT 12 ROWS ONLY
   </select>
   
   <select id="foodFindTotalPage" resultType="int"
    parameterType="hashmap"
   >
     SELECT CEIL(COUNT(*)/12.0)
     FROM menupan_food
     <where>
     <if test="fsArr!=null">
     <trim prefixOverrides="OR">
      <foreach collection="fsArr" item="fd">
       <trim prefix="OR">
         <choose>
           <when test="fd=='N'.toString()">
             name LIKE '%'||#{ss}||'%'
           </when>
           <when test="fd=='T'.toString()">
             type LIKE '%'||#{ss}||'%'
           </when>
           <when test="fd=='A'.toString()">
             address LIKE '%'||#{ss}||'%'
           </when>
         </choose>
       </trim>
      </foreach>
     </trim>
     </if>
     </where>
   </select>
</mapper>